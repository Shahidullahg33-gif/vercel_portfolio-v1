/* Base design tokens */
:root {
  --font-serif: Georgia, ui-serif, serif;
  --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, sans-serif;
  --fs--1: clamp(.82rem,.8rem + .2vw,.9rem);
  --fs-0: clamp(.95rem,.9rem + .35vw,1.05rem);
  --fs-1: clamp(1.15rem,1.05rem + .6vw,1.35rem);
  --fs-2: clamp(1.35rem,1.2rem + 1vw,1.8rem);
  --fs-3: clamp(1.7rem,1.4rem + 1.8vw,2.3rem);
  --fs-4: clamp(2.1rem,1.6rem + 2.8vw,3.1rem);
  --fs-5: clamp(2.7rem,1.8rem + 4vw,4rem);
  --lh-body:1.6;--lh-long:1.68;--measure:70ch;
  --space-xs:.5rem;--space-sm:.75rem;--space-md:1.1rem;--space-lg:1.75rem;--space-xl:2.5rem;
  --radius-sm:.3rem;--radius-md:.6rem;--radius-lg:1rem;
  --dur-xs:120ms;--dur-sm:180ms;--dur-md:250ms;--dur-lg:400ms;--ease:cubic-bezier(.16,.84,.44,1);
  --c-bg:#ffffff;--c-surface:#ffffff;--c-muted:#ececec;--c-border:#d0d4d9;--c-text:#0f172a;--c-text-alt:#485160;--c-card-text:#0f172a;--c-accent:#ff6b35;--c-accent-alt:#2a9d8f;--c-on-accent:#ffffff;--c-info:#4F46E5;--c-danger:#DC2626;
  color-scheme:light;
}

[data-theme='dark'] { --c-bg:#0f172a;--c-surface:#1e293b;--c-muted:#334155;--c-border:#475569;--c-text:#ffffff;--c-text-alt:#cbd5e1;--c-card-text:#ffffff;--c-accent:#0ea5e9;--c-accent-alt:#3b82f6;--c-on-accent:#ffffff; color-scheme:dark; }
[data-theme='colorful'] { --c-bg:#0D1321;--c-surface:#FFE66D;--c-text:#FFE66D;--c-text-alt:#182335;--c-card-text:#182335;--c-accent:#EF476F;--c-accent-alt:#06D6A0;--c-on-accent:#FFFFFF; }

/* Theme background strategies */
html { background: var(--c-bg); color: var(--c-text); }
/* Semantic text helpers with improved contrast */
.text-alt { color: var(--c-text-alt); }
.text-primary { color: var(--c-text); font-weight: 500; }
.text-contrast { color: var(--c-text); font-weight: 600; }
.muted { color: var(--c-text-alt); }
.icon-muted { color: var(--c-text-alt); transition:color .25s var(--ease); }
.group:hover .icon-muted { color: var(--c-text); }
.faded { color: var(--c-text); }
[data-theme='dark'] .faded,[data-theme='colorful'] .faded { color: color-mix(in srgb,var(--c-text) 85%, transparent); }
.on-accent { color: var(--c-on-accent,#fff); }

/* Enhanced text contrast for dark theme */
[data-theme='dark'] .text-contrast { 
  color: #ffffff; 
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); 
}
[data-theme='dark'] .text-primary { 
  color: #ffffff; 
  font-weight: 500; 
}
[data-theme='dark'] .text-alt { 
  color: #cbd5e1; 
  font-weight: 400; 
}
[data-theme='dark'] .muted { 
  color: #94a3b8; 
}

/* Ensure visibility on glass/acrylic backgrounds */
.glass .text-contrast,
.acrylic-card .text-contrast {
  color: var(--c-text);
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
}

[data-theme='dark'] .glass .text-contrast,
[data-theme='dark'] .acrylic-card .text-contrast {
  color: #ffffff;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}
[data-theme='colorful'] body { background: linear-gradient(140deg,#0D1321 10%,#111f34 45%,#0D1321 90%); }

/* Navigation variants with enhanced contrast */
.site-nav { backdrop-filter: blur(10px); display:flex; flex-direction:column; }
[data-theme='dark'] .site-nav { 
  background:rgba(15,23,42,.95); 
  border-bottom:1px solid rgba(255,255,255,0.1); 
  backdrop-filter: blur(20px) saturate(180%);
}
[data-theme='colorful'] .site-nav { background:linear-gradient(90deg,#EF476F,#FFD166,#06D6A0); }
.site-nav.nav-scrolled { box-shadow:0 4px 14px -6px rgba(0,0,0,.35); }
nav .nav-link { position:relative; color: var(--c-text); font-weight: 500; }
nav .nav-link.is-active::after { content:""; position:absolute; left:0; right:0; bottom:2px; height:2px; background:var(--c-accent); }
[data-theme='colorful'] nav .nav-link.is-active { background:linear-gradient(90deg,var(--c-accent),var(--c-accent-alt)); -webkit-background-clip:text; background-clip:text; color:transparent; }

/* Enhanced navigation text contrast */
[data-theme='dark'] nav .nav-link {
  color: #ffffff;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}
[data-theme='dark'] nav .nav-link:hover {
  color: #0ea5e9;
}

/* Buttons with enhanced contrast */
.btn { 
  --btn-bg:var(--c-accent); 
  --btn-fg:#fff; 
  --btn-border:var(--c-accent); 
  display:inline-flex; 
  align-items:center; 
  gap:.5ch; 
  font-weight:600; 
  padding:.65rem 1.1rem; 
  border-radius:var(--radius-sm); 
  background:var(--btn-bg); 
  color:var(--btn-fg); 
  border:1px solid var(--btn-border); 
  line-height:1.2; 
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  transition:background var(--dur-sm) var(--ease),color var(--dur-sm) var(--ease),box-shadow var(--dur-sm) var(--ease); 
}
.btn-outline { 
  background:transparent; 
  color:var(--c-accent); 
  font-weight:600;
  text-shadow: none;
}
.btn-outline:hover { 
  background:var(--c-accent); 
  color:#fff; 
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}
[data-theme='colorful'] .btn { background:linear-gradient(90deg,var(--c-accent),var(--c-accent-alt)); }
[data-theme='dark'] .btn:hover { box-shadow:0 0 0 3px rgba(14,165,233,.25); }

/* Enhanced button text contrast for dark theme */
[data-theme='dark'] .btn {
  color: #ffffff;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}
[data-theme='dark'] .btn-outline {
  color: #0ea5e9;
  border-color: #0ea5e9;
  text-shadow: none;
}

/* Links with improved contrast */
.prose a { 
  text-decoration:underline; 
  text-decoration-thickness:2px; 
  text-underline-offset:3px; 
  color: var(--c-accent);
  font-weight: 500;
  transition:color var(--dur-xs) var(--ease), text-decoration-color var(--dur-xs) var(--ease); 
}
[data-theme='dark'] .prose a { 
  color: #0ea5e9; 
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}
[data-theme='dark'] .prose a:hover { 
  color: #38bdf8; 
}
[data-theme='colorful'] .prose a { background:linear-gradient(90deg,var(--c-accent),var(--c-accent-alt)); -webkit-background-clip:text; background-clip:text; color:transparent; }

/* Focus ring */
:focus-visible { outline:2px solid var(--c-accent); outline-offset:3px; border-radius:4px; }
[data-theme='colorful'] :focus-visible { outline:2px solid var(--c-accent-alt); }

/* Reading mode & font scaling */
html.font-scale-lg { font-size:112%; }
html.font-scale-xl { font-size:120%; }
html.reading-mode body { max-width:70ch; margin-inline:auto; }
html.reading-mode .site-nav, html.reading-mode #scroll-progress { position:sticky; }

/* Article content ergonomics */
.article-content { max-width:70ch; }
.article-content p { hyphens:auto; hanging-punctuation:first last; }

/* Content visibility performance */
.cv-auto { content-visibility:auto; contain-intrinsic-size: 1000px 800px; }

/* Dark theme heading underline hover color shift */
[data-theme='dark'] h2, [data-theme='dark'] h3 { position:relative; }
[data-theme='dark'] h2:hover::after, [data-theme='dark'] h3:hover::after { background:linear-gradient(90deg,var(--c-accent),var(--c-accent-alt)); }
[data-theme='dark'] h2::after, [data-theme='dark'] h3::after { content:""; position:absolute; left:0; bottom:-4px; width:60px; height:3px; background:var(--c-accent); transition:background var(--dur-sm) var(--ease); }

/* Colorful hue rotate decorative (applied to elements with class .decor) */
[data-theme='colorful'] .decor { animation:huerotate 60s linear infinite; }
@keyframes huerotate { to { filter:hue-rotate(360deg); } }

/* Minimalist gradient overrides */
[data-theme='minimalist'] .text-gradient { background:none !important; -webkit-text-fill-color: currentColor; color: currentColor; animation:none; }
[data-theme='minimalist'] .btn { box-shadow:none; }

/* Container queries */
.case-grid, .services-grid { container-type:inline-size; }
@container (min-width:650px) {
  .case-grid article, .services-grid > div { padding:2rem; }
  .case-grid article h2 { font-size:clamp(1.4rem,1.1rem + 1vw,2rem); }
}
@container (min-width:960px) {
  .case-grid { grid-template-columns:repeat(2,1fr); }
}

/* Margin notes / blockquotes elevated */
.article-content blockquote { position:relative; margin:1.5rem 0; padding:1rem 1.25rem; border-left:4px solid var(--c-accent-dynamic,var(--c-accent)); background:linear-gradient(90deg,var(--c-accent-dynamic,var(--c-accent))10%,transparent); background-size:200% 100%; background-position:0 0; transition:background-position var(--dur-md) var(--ease); }
.article-content blockquote:hover { background-position:100% 0; }
@media (min-width:1100px) {
  .article-content blockquote { float:right; width:40%; margin:0 0 1.5rem 1.5rem; font-size:0.95em; }
  html.reading-mode .article-content blockquote { float:none; width:auto; margin:1.5rem 0; }
}

/* Scroll progress */
#scroll-progress { position:fixed;top:0;left:0;height:4px;background:linear-gradient(90deg,var(--c-accent),var(--c-accent-alt));width:0;z-index:1000;transition:width var(--dur-xs) linear; }

/* Skip link */
.skip-link { position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden; }
.skip-link:focus { left:1rem;top:1rem;width:auto;height:auto;padding:.6rem 1rem;background:var(--c-surface);color:var(--c-text);border:2px solid var(--c-accent);border-radius:var(--radius-sm);z-index:10000; }

/* Reveal animation */
.reveal { opacity:0; transform:translateY(24px); transition:opacity var(--dur-md) var(--ease), transform var(--dur-md) var(--ease); }
.reveal.is-in { opacity:1; transform:none; }
.reduced-motion .reveal { opacity:1 !important; transform:none !important; }

/* Tilt fallback transition */
.tilt { transition:transform var(--dur-sm) var(--ease); will-change:transform; }
.reduced-motion .tilt { transition:none; }

/* Keyword highlight + badges */
.kw-highlight { background: color-mix(in srgb,var(--c-accent) 40%, transparent); padding:0 .15em; border-radius:2px; box-decoration-break:clone; }
.badge { display:inline-flex; align-items:center; gap:.35ch; font-size:.65rem; letter-spacing:.05em; text-transform:uppercase; padding:.35rem .55rem; border:1px solid var(--c-border); border-radius:var(--radius-sm); background:var(--c-surface); color:var(--c-text-alt); font-weight:600; }
.badge.difficulty-easy { border-color: var(--c-accent-alt); color: var(--c-accent-alt); }
.badge.difficulty-intermediate { border-color: var(--c-accent); color: var(--c-accent); }
.badge.difficulty-deep { border-color: var(--c-danger,#B91C1C); color: var(--c-danger,#B91C1C); }
